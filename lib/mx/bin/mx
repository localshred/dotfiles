#!/usr/bin/env bb

(ns mx.bin.mx
  (:require [babashka.process :as p]))

(def mx-root (str (System/getProperty "user.home") "/code/src/utils/dotfiles/lib/mx"))

(declare run-command show-help)

(def available-commands
  {"goto" (str mx-root "/commands/goto.clj")
   "prs" (str mx-root "/commands/prs.clj")})

(defn main
  "Main entry point for mx CLI"
  [& args]
  (if (or (empty? args)
        (contains? #{"-h" "--help"} (first args)))
    (do (show-help) 0)
    (let [command (first args)
          cmd-args (rest args)]
      (run-command command cmd-args))))

(defn run-command
  "Execute the specified command with given arguments"
  [command args]
  (if-let [script-path (get available-commands command)]
    (let [result (apply p/process {:inherit true} script-path args)]
      (-> result p/check :exit))
    (do
      (show-help)
      1)))

(defn show-help
  "Display help information"
  []
  (println "ðŸ”§ mx - Local Development Utils")
  (println)
  (println "Usage: mx <command> [options]")
  (println)
  (println "Available commands:")
  (doseq [[cmd desc] [["goto" "Navigate to SCM provider URLs (repos, issues, PRs)"]
                      ["prs" "Show open PRs with current statuses or review requests"]]]
    (println (format "  %-10s %s" cmd desc)))
  (println)
  (println "Examples:")
  (println "  mx goto -u foo -r bar    # Navigate to github.com/foo/bar")
  (println "  mx prs                   # Show PR status across all repositories")
  (println "  mx prs --reviews         # Show PRs requesting your review")
  (println)
  (println "Options:")
  (println "  -h, --help         # Show this help message"))

;; Run the CLI
(System/exit (apply main *command-line-args*))