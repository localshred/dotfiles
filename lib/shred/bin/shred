#!/usr/bin/env bb

(ns shred.bin.shred
  (:require [babashka.process :as p]))

(def shred-root (str (System/getProperty "user.home") "/code/src/utils/dotfiles/lib/shred"))

(declare run-command show-help)

(def available-commands
  {"prs" (str shred-root "/commands/prs.clj")})

(defn main
  "Main entry point for shred CLI"
  [& args]
  (if (or (empty? args)
        (contains? #{"-h" "--help"} (first args)))
    (do (show-help) 0)
    (let [command (first args)
          cmd-args (rest args)]
      (run-command command cmd-args))))

(defn run-command
  "Execute the specified command with given arguments"
  [command args]
  (if-let [script-path (get available-commands command)]
    (do
      (println (format "üöÄ Running shred %s...\n" command))
      (let [result (apply p/process {:inherit true} script-path args)]
        (-> result p/check :exit)))
    (do
      (println (format "‚ùå Unknown command: %s\n" command))
      (show-help)
      1)))

(defn show-help
  "Display help information"
  []
  (println "üîß Shred - Local Development Utils")
  (println)
  (println "Usage: shred <command> [options]")
  (println)
  (println "Available commands:")
  (doseq [[cmd desc] [["prs" "Show open PRs with current statuses"]]]
    (println (format "  %-10s %s" cmd desc)))
  (println)
  (println "Examples:")
  (println "  shred prs          # Show PR status across all repositories")
  (println)
  (println "Options:")
  (println "  -h, --help         # Show this help message"))

;; Run the CLI
(System/exit (apply main *command-line-args*))